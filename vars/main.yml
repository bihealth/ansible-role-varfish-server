---

# bihealth.sodar_core_app -------------------------------------------------------------------------

sodar_core_app_name: varfish

sodar_core_app_git_repo: "{{ varfish_git_repo }}"

sodar_core_app_email_prefix: "{{ varfish_email_prefix }}"

sodar_core_app_celery_enabled: true

sodar_core_app_celeryd_workers:
  - name: default
    queues:
      - default
    concurrency: "{{ varfish_celery_workers_default }}"
  - name: query
    queues:
      - query
    concurrency: "{{ varfish_celery_workers_query }}"
  - name: import
    queues:
      - import
    concurrency: "{{ varfish_celery_workers_import }}"

sodar_core_app_backend_plugins:
  - "timeline_backend"

sodar_core_app_systemd_env_snippet: |
  {% if varfish_sentry_dsn|length>0 %}
  DJANGO_SENTRY_DSN="{{ varfish_sentry_dsn }}"
  {% endif %}

  VARFISH_ENABLE_CADD={{ 1 if varfish_enable_cadd else 0 }}
  VARFISH_CADD_REST_API_URL={{ varfish_cadd_rest_api_url }}

  VARFISH_ENABLE_JANNOVAR={{ 1 if varfish_enable_jannovar else 0 }}
  VARFISH_JANNOVAR_REST_API_URL={{ varfish_jannovar_rest_api_url }}

  VARFISH_ENABLE_EXOMISER_PRIORITISER={{ 1 if varfish_enable_exomiser_prioritiser else 0 }}
  VARFISH_EXOMISER_PRIORITISER_API_URL={{ varfish_exomiser_prioritiser_api_url }}

  VARFISH_ENABLE_SVS={{ 1 if varfish_enable_svs else 0 }}
  VARFISH_KIOSK_MODE={{ 1 if varfish_enable_kiosk_mode else 0 }}

  {% if varfish_enable_kiosk_mode or varfish_enable_annotator %}
  VARFISH_KIOSK_CONDA_PATH=/srv/{{ sodar_core_app_name }}-web/{{ varfish_version }}-conda/bin/activate

  {% set release_base %}/srv/{{ sodar_core_app_name }}-web/varfish-annotator/{{ varfish_annotator_data_release }}{% endset %}
  VARFISH_KIOSK_VARFISH_ANNOTATOR_DB_PATH={{ release_base }}/varfish-annotator-db-{{ varfish_annotator_data_release }}.h2.db
  VARFISH_KIOSK_VARFISH_ANNOTATOR_ENSEMBL_SER_PATH={{ release_base }}/varfish-annotator-transcripts-{{ varfish_annotator_data_release }}/hg19_ensembl.ser
  VARFISH_KIOSK_VARFISH_ANNOTATOR_REFSEQ_SER_PATH={{ release_base }}/varfish-annotator-transcripts-{{ varfish_annotator_data_release }}/hg19_refseq_curated.ser
  VARFISH_KIOSK_VARFISH_ANNOTATOR_REFERENCE_PATH={{ release_base }}/varfish-annotator-db-{{ varfish_annotator_data_release }}/GRCh37/reference/hs37d5/hs37d5.fa
  {% endif %}

# bihealth.python3 --------------------------------------------------------------------------------

python3_versions:
  - "3.6"
